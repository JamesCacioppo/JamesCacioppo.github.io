<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Safer bash scripts with 'set -euxo pipefail' | Modern Engineer</title>
<meta name=description content="Safer bash scripts, taken from Tom Van Eyck
"><meta property="og:title" content="Safer bash scripts with 'set -euxo pipefail'"><meta property="og:description" content="Safer bash scripts, taken from Tom Van Eyck
"><meta property="og:type" content="article"><meta property="og:url" content="/docs/randomtobesortednotes/safer_bash_scripts_with_set_euxo_pipefail/"><meta property="article:section" content="docs"><meta property="article:published_time" content="2023-03-07T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-17T09:09:27-04:00"><meta property="og:site_name" content="Modern Engineer"><meta itemprop=name content="Safer bash scripts with 'set -euxo pipefail'"><meta itemprop=description content="Safer bash scripts, taken from Tom Van Eyck
"><meta itemprop=datePublished content="2023-03-07T00:00:00+00:00"><meta itemprop=dateModified content="2023-03-17T09:09:27-04:00"><meta itemprop=wordCount content="1702"><meta itemprop=keywords content="bash,scripts,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Safer bash scripts with 'set -euxo pipefail'"><meta name=twitter:description content="Safer bash scripts, taken from Tom Van Eyck
"><link rel=preload href=/scss/main.min.5081230fda7a265fa5fc10130b5bca4f0868fd0e77a3fa6ae4f2d28669ce5899.css as=style><link href=/scss/main.min.5081230fda7a265fa5fc10130b5bca4f0868fd0e77a3fa6ae4f2d28669ce5899.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script><link rel=stylesheet href=/css/prism.css></head><body class=td-page><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Modern Engineer</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/about/><span>About</span></a></li><li class=nav-item><a class="nav-link active" href=/docs/><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/blog/><span>Blog</span></a></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsrandomtobesortednotes-li><a href=/docs/randomtobesortednotes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsrandomtobesortednotes><span>Random Notes</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsrandomtobesortednotesbash_globbing-li><a href=/docs/randomtobesortednotes/bash_globbing/ title="Bash Globbing'" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsrandomtobesortednotesbash_globbing><span>Bash globbing</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docsrandomtobesortednotessafer_bash_scripts_with_set_euxo_pipefail-li><a href=/docs/randomtobesortednotes/safer_bash_scripts_with_set_euxo_pipefail/ title="Safer bash scripts with 'set -euxo pipefail'" class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-docsrandomtobesortednotessafer_bash_scripts_with_set_euxo_pipefail><span class=td-sidebar-nav-active-item>Safer BASH</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsrandomtobesortednotesscratch_pad-li><a href=/docs/randomtobesortednotes/scratch_pad/ title="Scratch Pad" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsrandomtobesortednotesscratch_pad><span>Scratch PAd</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsrandomtobesortednotespulumi-li><a href=/docs/randomtobesortednotes/pulumi/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsrandomtobesortednotespulumi><span>Pulumi</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsencryption-li><a href=/docs/encryption/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsencryption><span>Encryption</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsencryptionopenssl-cheat-sheet-li><a href=/docs/encryption/openssl-cheat-sheet/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsencryptionopenssl-cheat-sheet><span>OpenSSL Cheat Sheet</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsgit-li><a href=/docs/git/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsgit><span>Git</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgitworking_tree-li><a href=/docs/git/working_tree/ title="The Working Tree and Stashing" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsgitworking_tree><span>Working Tree and Stash</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgittagging-li><a href=/docs/git/tagging/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsgittagging><span>Git Tagging</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgitcommands-li><a href=/docs/git/commands/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsgitcommands><span>Git Commands</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgitconfiguration-li><a href=/docs/git/configuration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsgitconfiguration><span>Git Configuration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgitbranching-li><a href=/docs/git/branching/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsgitbranching><span>Git Branching</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskube-bench-li><a href=/docs/kube-bench/ title="Kube Bench" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docskube-bench><span>kube-bench</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docspython-li><a href=/docs/python/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docspython><span>Python</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docspythonvenv-li><a href=/docs/python/venv/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docspythonvenv><span>venv</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docspythonpytest-li><a href=/docs/python/pytest/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docspythonpytest><span>Pytest</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docspythonpyenv-li><a href=/docs/python/pyenv/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docspythonpyenv><span>Pyenv</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmarkdown-li><a href=/docs/markdown/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsmarkdown><span>Markdown</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/JamesCacioppo/JamesCacioppo.github.io/tree/main/content/en/docs/RandomToBeSortedNotes/safer_bash_scripts_with_set_euxo_pipefail.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/JamesCacioppo/JamesCacioppo.github.io/edit/main/content/en/docs/RandomToBeSortedNotes/safer_bash_scripts_with_set_euxo_pipefail.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/JamesCacioppo/JamesCacioppo.github.io/new/main/content/en/docs/RandomToBeSortedNotes?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/JamesCacioppo/JamesCacioppo.github.io/issues/new?title=Safer%20bash%20scripts%20with%20%27set%20-euxo%20pipefail%27" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/JamesCacioppo/JamesCacioppo.github.io/issues/new class="td-page-meta--project td-page-meta__project-issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a>
<a id=print href=/docs/randomtobesortednotes/_print/><i class="fa-solid fa-print fa-fw"></i> Print entire section</a></div><div class=td-toc><nav id=TableOfContents><ul><li><ul><li><a href=#set--e>set -e</a></li><li><a href=#set--o-pipefail>set -o pipefail</a></li><li><a href=#set--u>set -u</a></li><li><a href=#set--x>set -x</a></li><li><a href=#reader-suggestion-set--e>Reader suggestion: set -E</a></li><li><a href=#conclusion>Conclusion</a></li></ul></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Tag Cloud</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=/tags/bash/ data-taxonomy-term=bash><span class=taxonomy-label>Bash</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/tags/branching/ data-taxonomy-term=branching><span class=taxonomy-label>Branching</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/certificates/ data-taxonomy-term=certificates><span class=taxonomy-label>Certificates</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/docs/ data-taxonomy-term=docs><span class=taxonomy-label>Docs</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/tags/git/ data-taxonomy-term=git><span class=taxonomy-label>Git</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=/tags/git-commands/ data-taxonomy-term=git-commands><span class=taxonomy-label>Git Commands</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/git-config/ data-taxonomy-term=git-config><span class=taxonomy-label>Git-Config</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/git-stash/ data-taxonomy-term=git-stash><span class=taxonomy-label>Git-Stash</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/git-tag/ data-taxonomy-term=git-tag><span class=taxonomy-label>Git-Tag</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/globbing/ data-taxonomy-term=globbing><span class=taxonomy-label>Globbing</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/iac/ data-taxonomy-term=iac><span class=taxonomy-label>Iac</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/k8s/ data-taxonomy-term=k8s><span class=taxonomy-label>K8s</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/kube-bench/ data-taxonomy-term=kube-bench><span class=taxonomy-label>Kube-Bench</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/kubernetes/ data-taxonomy-term=kubernetes><span class=taxonomy-label>Kubernetes</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/markdown/ data-taxonomy-term=markdown><span class=taxonomy-label>Markdown</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/md/ data-taxonomy-term=md><span class=taxonomy-label>Md</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/openssl/ data-taxonomy-term=openssl><span class=taxonomy-label>Openssl</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/pulumi/ data-taxonomy-term=pulumi><span class=taxonomy-label>Pulumi</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/pyenv/ data-taxonomy-term=pyenv><span class=taxonomy-label>Pyenv</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/pytest/ data-taxonomy-term=pytest><span class=taxonomy-label>Pytest</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/python/ data-taxonomy-term=python><span class=taxonomy-label>Python</span><span class=taxonomy-count>4</span></a></li><li><a class=taxonomy-term href=/tags/scripts/ data-taxonomy-term=scripts><span class=taxonomy-label>Scripts</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/security/ data-taxonomy-term=security><span class=taxonomy-label>Security</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/ssl/ data-taxonomy-term=ssl><span class=taxonomy-label>Ssl</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/tagging/ data-taxonomy-term=tagging><span class=taxonomy-label>Tagging</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/tls/ data-taxonomy-term=tls><span class=taxonomy-label>Tls</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/venv/ data-taxonomy-term=venv><span class=taxonomy-label>Venv</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/working-tree/ data-taxonomy-term=working-tree><span class=taxonomy-label>Working Tree</span><span class=taxonomy-count>1</span></a></li></ul></div><div class="taxonomy taxonomy-terms-cloud taxo-categories"><h5 class=taxonomy-title>Categories</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=/categories/development/ data-taxonomy-term=development><span class=taxonomy-label>Development</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=/categories/docs/ data-taxonomy-term=docs><span class=taxonomy-label>Docs</span><span class=taxonomy-count>12</span></a></li><li><a class=taxonomy-term href=/categories/examples/ data-taxonomy-term=examples><span class=taxonomy-label>Examples</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/python/ data-taxonomy-term=python><span class=taxonomy-label>Python</span><span class=taxonomy-count>1</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/docs/>Documentation</a></li><li class=breadcrumb-item><a href=/docs/randomtobesortednotes/>Random Notes</a></li><li class="breadcrumb-item active" aria-current=page>Safer BASH</li></ol></nav><div class=td-content><h1>Safer bash scripts with 'set -euxo pipefail'</h1><div class=lead>Safer bash scripts, taken from Tom Van Eyck</div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-tags"><h5 class=taxonomy-title>Tags:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=/tags/bash/ data-taxonomy-term=bash><span class=taxonomy-label>Bash</span></a></li><li><a class=taxonomy-term href=/tags/scripts/ data-taxonomy-term=scripts><span class=taxonomy-label>Scripts</span></a></li></ul></div><div class="taxonomy taxonomy-terms-article taxo-categories"><h5 class=taxonomy-title>Categories:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=/categories/docs/ data-taxonomy-term=docs><span class=taxonomy-label>Docs</span></a></li></ul></div></header><div class="pageinfo pageinfo-primary"><p>The following post was sourced from Tom Van Eyck&rsquo;s blog over at <a href=https://vaneyckt.io/posts/safer_bash_scripts_with_set_euxo_pipefail/>https://vaneyckt.io/posts/safer_bash_scripts_with_set_euxo_pipefail/</a>. His last post was in 2018 and his github has been idle for as long so I&rsquo;ve become worried that something might happen to his blog. Because I refer to this article so frequently, I have decided to preserve it here.</p></div><p>Often times developers go about writing bash scripts the same as writing code in a higher-level language. This is a big mistake as higher-level languages offer safeguards that are not present in bash scripts by default. For example, a Ruby script will throw an error when trying to read from an uninitialized variable, whereas a bash script won&rsquo;t. In this article, we&rsquo;ll look at how we can improve on this.</p><p>The bash shell comes with several builtin commands for modifying the behavior of the shell itself. We are particularly interested in the <a href=https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html>set builtin</a>, as this command has several options that will help us write safer scripts. I hope to convince you that it&rsquo;s a really good idea to add <code>set -euxo pipefail</code> to the beginning of all your future bash scripts.</p><h3 id=set--e>set -e<a class=td-heading-self-link href=#set--e aria-label="Heading self-link"></a></h3><p>The <code>-e</code> option will cause a bash script to exit immediately when a command fails. This is generally a vast improvement upon the default behavior where the script just ignores the failing command and continues with the next line. This option is also smart enough to not react on failing commands that are part of conditional statements. Moreover, you can append a command with <code>|| true</code> for those rare cases where you don&rsquo;t want a failing command to trigger an immediate exit.</p><h4 id=before>Before<a class=td-heading-self-link href=#before aria-label="Heading self-link"></a></h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># &#39;foo&#39; is a non-existing command</span>
</span></span><span style=display:flex><span>foo
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;bar&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># output</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ------</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># line 4: foo: command not found</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># bar</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Note how the script didn&#39;t exit when the foo command could not be found.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Instead it continued on and echoed &#39;bar&#39;.</span>
</span></span></code></pre></div><h4 id=after>After<a class=td-heading-self-link href=#after aria-label="Heading self-link"></a></h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>set</span> -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># &#39;foo&#39; is a non-existing command</span>
</span></span><span style=display:flex><span>foo
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;bar&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># output</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ------</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># line 5: foo: command not found</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># This time around the script exited immediately when the foo command wasn&#39;t found.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Such behavior is much more in line with that of higher-level languages.</span>
</span></span></code></pre></div><h4 id=any-command-returning-a-non-zero-exit-code-will-cause-an-immediate-exit>Any command returning a non-zero exit code will cause an immediate exit<a class=td-heading-self-link href=#any-command-returning-a-non-zero-exit-code-will-cause-an-immediate-exit aria-label="Heading self-link"></a></h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>set</span> -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># &#39;ls&#39; is an existing command, but giving it a nonsensical param will cause</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># it to exit with exit code 1</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>$(</span>ls foobar<span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;bar&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># output</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ------</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ls: foobar: No such file or directory</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># I&#39;m putting this in here to illustrate that it&#39;s not just non-existing commands</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># that will cause an immediate exit.</span>
</span></span></code></pre></div><h4 id=preventing-an-immediate-exit>Preventing an immediate exit<a class=td-heading-self-link href=#preventing-an-immediate-exit aria-label="Heading self-link"></a></h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>set</span> -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>foo <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>$(</span>ls foobar<span style=color:#204a87;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;bar&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># output</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ------</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># line 4: foo: command not found</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ls: foobar: No such file or directory</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># bar</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Sometimes we want to ensure that, even when &#39;set -e&#39; is used, the failure of</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># a particular command does not cause an immediate exit. We can use &#39;|| true&#39; for this.</span>
</span></span></code></pre></div><h4 id=failing-commands-in-a-conditional-statement-will-not-cause-an-immediate-exit>Failing commands in a conditional statement will not cause an immediate exit<a class=td-heading-self-link href=#failing-commands-in-a-conditional-statement-will-not-cause-an-immediate-exit aria-label="Heading self-link"></a></h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>set</span> -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># we make &#39;ls&#39; exit with exit code 1 by giving it a nonsensical param</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> ls foobar<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;foo&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>else</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;bar&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># output</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ------</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ls: foobar: No such file or directory</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># bar</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Note that &#39;ls foobar&#39; did not cause an immediate exit despite exiting with</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># exit code 1. This is because the command was evaluated as part of a</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># conditional statement.</span>
</span></span></code></pre></div><p>That&rsquo;s all for <code>set -e</code>. However, <code>set -e</code> by itself is far from enough. We can further improve upon the behavior created by <code>set -e</code> by combining it with <code>set -o pipefail</code>. Let&rsquo;s have a look at that next.</p><h3 id=set--o-pipefail>set -o pipefail<a class=td-heading-self-link href=#set--o-pipefail aria-label="Heading self-link"></a></h3><p>The bash shell normally only looks at the exit code of the last command of a pipeline. This behavior is not ideal as it causes the <code>-e</code> option to only be able to act on the exit code of a pipeline&rsquo;s last command. This is where <code>-o pipefail</code> comes in. This particular option sets the exit code of a pipeline to that of the rightmost command to exit with a non-zero status, or to zero if all commands of the pipeline exit successfully.</p><h4 id=before-1>Before<a class=td-heading-self-link href=#before-1 aria-label="Heading self-link"></a></h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>set</span> -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># &#39;foo&#39; is a non-existing command</span>
</span></span><span style=display:flex><span>foo <span style=color:#000;font-weight:700>|</span> <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;a&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;bar&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># output</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ------</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># a</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># line 5: foo: command not found</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># bar</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Note how the non-existing foo command does not cause an immediate exit, as</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># it&#39;s non-zero exit code is ignored by piping it with &#39;| echo &#34;a&#34;&#39;.</span>
</span></span></code></pre></div><h4 id=after-1>After<a class=td-heading-self-link href=#after-1 aria-label="Heading self-link"></a></h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>set</span> -eo pipefail
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># &#39;foo&#39; is a non-existing command</span>
</span></span><span style=display:flex><span>foo <span style=color:#000;font-weight:700>|</span> <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;a&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;bar&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># output</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ------</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># a</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># line 5: foo: command not found</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># This time around the non-existing foo command causes an immediate exit, as</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># &#39;-o pipefail&#39; will prevent piping from causing non-zero exit codes to be ignored.</span>
</span></span></code></pre></div><p>This section hopefully made it clear that <code>-o pipefail</code> provides an important improvement upon just using <code>-e</code> by itself. However, as we shall see in the next section, we can still do more to make our scripts behave like higher-level languages.</p><h3 id=set--u>set -u<a class=td-heading-self-link href=#set--u aria-label="Heading self-link"></a></h3><p>This option causes the bash shell to treat unset variables as an error and exit immediately. Unset variables are a common cause of bugs in shell scripts, so having unset variables cause an immediate exit is often highly desirable behavior.</p><h4 id=before-2>Before<a class=td-heading-self-link href=#before-2 aria-label="Heading self-link"></a></h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>set</span> -eo pipefail
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#000>$a</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;bar&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># output</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ------</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># bar</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The default behavior will not cause unset variables to trigger an immediate exit.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># In this particular example, echoing the non-existing $a variable will just cause</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># an empty line to be printed.</span>
</span></span></code></pre></div><h4 id=after-2>After<a class=td-heading-self-link href=#after-2 aria-label="Heading self-link"></a></h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>set</span> -euo pipefail
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;</span><span style=color:#000>$a</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;bar&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># output</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ------</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># line 5: a: unbound variable</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Notice how &#39;bar&#39; no longer gets printed. We can clearly see that &#39;-u&#39; did indeed</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># cause an immediate exit upon encountering an unset variable.</span>
</span></span></code></pre></div><h4 id=dealing-with-a-b-variable-assignments>Dealing with ${a:-b} variable assignments<a class=td-heading-self-link href=#dealing-with-a-b-variable-assignments aria-label="Heading self-link"></a></h4><p>Sometimes you&rsquo;ll want to use a <a href=https://unix.stackexchange.com/questions/122845/using-a-b-for-variable-assignment-in-scripts/122878>${a:-b} variable assignment</a> to ensure a variable is assigned a default value of <code>b</code> when <code>a</code> is either empty or undefined. The <code>-u</code> option is smart enough to not cause an immediate exit in such a scenario.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>set</span> -euo pipefail
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>DEFAULT</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>5</span>
</span></span><span style=display:flex><span><span style=color:#000>RESULT</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>VAR</span><span style=color:#204a87;font-weight:700>:-</span><span style=color:#000>$DEFAULT</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;</span><span style=color:#000>$RESULT</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># output</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ------</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 5</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Even though VAR was not defined, the &#39;-u&#39; option realizes there&#39;s no need to cause</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># an immediate exit in this scenario as a default value has been provided.</span>
</span></span></code></pre></div><h4 id=using-conditional-statements-that-check-if-variables-are-set>Using conditional statements that check if variables are set<a class=td-heading-self-link href=#using-conditional-statements-that-check-if-variables-are-set aria-label="Heading self-link"></a></h4><p>Sometimes you want your script to not immediately exit when an unset variable is encountered. A common example is checking for a variable&rsquo;s existence inside an <code>if</code> statement.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>set</span> -euo pipefail
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>[</span> -z <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>MY_VAR</span><span style=color:#204a87;font-weight:700>:-</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#ce5c00;font-weight:700>]</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;MY_VAR was not set&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># output</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ------</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># MY_VAR was not set</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># In this scenario we don&#39;t want our program to exit when the unset MY_VAR variable</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># is evaluated. We can prevent such an exit by using the same syntax as we did in the</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># previous example, but this time around we specify no default value.</span>
</span></span></code></pre></div><p>This section has brought us a lot closer to making our bash shell behave like higher-level languages. While <code>-euo pipefail</code> is great for the early detection of all kinds of problems, sometimes it won&rsquo;t be enough. This is why in the next section we&rsquo;ll look at an option that will help us figure out those really tricky bugs that you encounter every once in a while.</p><h3 id=set--x>set -x<a class=td-heading-self-link href=#set--x aria-label="Heading self-link"></a></h3><p>The <code>-x</code> option causes bash to print each command before executing it. This can be a great help when trying to debug a bash script failure. Note that arguments get expanded before a command gets printed, which will cause our logs to contain the actual argument values that were present at the time of execution!</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>set</span> -euxo pipefail
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>a</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>5</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#000>$a</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;bar&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># output</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ------</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># + a=5</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># + echo 5</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 5</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># + echo bar</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># bar</span>
</span></span></code></pre></div><p>That&rsquo;s it for the <code>-x</code> option. It&rsquo;s pretty straightforward, but can be a great help for debugging. Next up, we&rsquo;ll look at an option I had never heard of before that was suggested by a reader of this blog.</p><h3 id=reader-suggestion-set--e>Reader suggestion: set -E<a class=td-heading-self-link href=#reader-suggestion-set--e aria-label="Heading self-link"></a></h3><p><a href=http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_12_02.html>Traps</a> are pieces of code that fire when a bash script catches certain signals. Aside from the usual signals (e.g. <code>SIGINT</code>, <code>SIGTERM</code>, &mldr;), traps can also be used to catch special bash signals like <code>EXIT</code>, <code>DEBUG</code>, <code>RETURN</code>, and <code>ERR</code>. However, reader Kevin Gibbs pointed out that using <code>-e</code> without <code>-E</code> will cause an <code>ERR</code> trap to not fire in certain scenarios.</p><h4 id=before-3>Before<a class=td-heading-self-link href=#before-3 aria-label="Heading self-link"></a></h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>set</span> -euo pipefail
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87>trap</span> <span style=color:#4e9a06>&#34;echo ERR trap fired!&#34;</span> ERR
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>myfunc<span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># &#39;foo&#39; is a non-existing command</span>
</span></span><span style=display:flex><span>  foo
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>myfunc
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;bar&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># output</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ------</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># line 9: foo: command not found</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Notice that while &#39;-e&#39; did indeed cause an immediate exit upon trying to execute</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># the non-existing foo command, it did not case the ERR trap to be fired.</span>
</span></span></code></pre></div><h4 id=after-3>After<a class=td-heading-self-link href=#after-3 aria-label="Heading self-link"></a></h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>set</span> -Eeuo pipefail
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87>trap</span> <span style=color:#4e9a06>&#34;echo ERR trap fired!&#34;</span> ERR
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>myfunc<span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># &#39;foo&#39; is a non-existing command</span>
</span></span><span style=display:flex><span>  foo
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>myfunc
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;bar&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># output</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ------</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># line 9: foo: command not found</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ERR trap fired!</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Not only do we still have an immediate exit, we can also clearly see that the</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ERR trap was actually fired now.</span>
</span></span></code></pre></div><p>The documentation states that <code>-E</code> needs to be set if we want the <code>ERR</code> trap to be inherited by shell functions, command substitutions, and commands that are executed in a subshell environment. The <code>ERR</code> trap is normally not inherited in such cases.</p><h3 id=conclusion>Conclusion<a class=td-heading-self-link href=#conclusion aria-label="Heading self-link"></a></h3><p>I hope this post showed you why using <code>set -euxo pipefail</code> (or <code>set -Eeuxo pipefail</code>) is such a good idea. If you have any other options you want to suggest, then please let me know and I&rsquo;ll be happy to add them to this list.</p><div class=td-page-meta__lastmod>Last modified March 17, 2023: <a href=https://github.com/JamesCacioppo/JamesCacioppo.github.io/commit/43ffff34dd13076049404ab34e8d280f034fd7d2>Add a couple pages and start working on taxonomies (43ffff3)</a></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/JamesCacioppo/JamesCacioppo.github.io.git aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2022&ndash;2025
<span class=td-footer__authors>James Cacioppo | <a href=https://creativecommons.org/licenses/by/4.0>CC BY 4.0</a></span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.26b35480299b932e285af8358c943de97509b95a0086d091584e7cb9b00c5c7b.js integrity="sha256-JrNUgCmbky4oWvg1jJQ96XUJuVoAhtCRWE58ubAMXHs=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/tabpane-persist.js></script></body></html>